# Handwriting Transcription for Herbarium Sheet Labels 

This project is designed to research possibilities for automated or semiautomated transcription of herbarium sheet labels (and all text), both handwritten and typed.

## Environment Setup
1. Create a Python 3.8 virtual environment. For example, in Anaconda Terminal:
    - `conda create -n <envname> python=3.8 pip`
    - `conda activate <envname>`
    - `pip install -r requirements.txt`
    - Install the needed nltk corpora by running the `requirements-nltk.py` script. For example, in the same Anaconda window, execute:
        - `python requirements-nltk.py`
2. Download your Google Cloud Service Account Key. Save the file in this main directory, e.g. `service_account_token.json`. (See [Google Cloud help center](https://cloud.google.com/docs/authentication/production#cloud-console) for more guidance.)
3. Copy the `Configuration-plain.cfg` file as `Configuration.cfg`.
    2. Edit the file to add the name of your service account token (in the `GOOGLE_CLOUD_VISION_API` section, under `serviceAccountTokenPath={name-of-your-service-account-token}`.
    3. Update any other settings if desired.

## Workflow/Scripts
*under development, 1 March 2021*

- `get_image_urls_from_fern_portal.py`
   - Given an occurrence CSV downloaded from the [Fern Portal](https://pteridoportal.org/), find the image file URL for each row.
   - 
   - Sample output, where columns `id` through `reference` are from the original CSV, and the column `img_url` has been added:

   | id  | ... | references                                                                      | img_url                                                         |
   |-----|-----|---------------------------------------------------------------------------------|-----------------------------------------------------------------|
   | 939 | ... | https://www.pteridoportal.org/portal/collections/individual/index.php?occid=939 | http://fm-digital-assets.fieldmuseum.org/1112/912/C0611042F.jpg |
   | 952 | ... | https://www.pteridoportal.org/portal/collections/individual/index.php?occid=952 | No image; specimen is likely protected.                         |
     

   

- `fuzzy_binomial_match.py`
   - Given a txt file of generated genus/species names (e.g. generated by OCR), use fuzzy matching ratio to find the closest match in the `list_of_scientific_names.txt`.
   - The input text file should be given as the first sys arg, e.g.
   - `python fuzzy_binomial_match.py list_of_names_to_match.txt`
   - The results are saved as a CSV file, `best_binomial_matches.csv`. The first column shows the text from the input file. Sample output:
     
      | search_query            | best_matches               | best_match_ratio |
      |-------------------------|----------------------------|------------------|
      | Adiantum pedatum        | ['adiantum pedatum']       | 100              |
      | Polypodium virginiangan | ['polypodium virginianum'] | 89               |

- 

## Credits
Project codebase developed for the Grainger Bioinformatics Center at the Field Museum.  Code developed by Beth McDonald ([@emcdona1](https://github.com/emcdona1)), developed under the guidance of Dr. Rick Ree and Dr. Matt von Konrat, Field Museum.

Original code for a GUI system with local database developed by Keshab Panthi ([@kpanthi](https://github.com/kpanthi)), NEIU.